---
layout: default
---
<body class="site">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  

    

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
<div class="post-header mb2">
  <h2>Magnetic Stripe Card Reader</h2>
  <span class="post-meta">Jun, 2012 to August, 2013</span><br>
  
  <span class="post-meta small">
  
    10 minutes read
  
  </span>
</div>
<article class="post-content">
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<h3>Overview</h3>
<p>A magnetic card is a type of card capable of storing data by modifying the magnetism of 
tiny iron-based magnetic particles on a band of magnetic material on the card. The data on the stripe is read by swiping 
against a <a href="http://www.magneticheads.com/"> magnetic reading head</a>. Magnetic stripe cards are commonly used in credit cards, identity cards, and transportation tickets.  </p>  

<p>For building the prototype we employed <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/39996f.pdf">PIC24FJ128GA310</a> 16-bit microcontroller.The on chip ADC, an <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/21668d.pdf"> operational amplifier</a>, and a fast controller enabled the integration of magnetic card reader functionality in a very small space with few external components. An external operational amplifier is used to amplify the signal and to make the signal suitable for unipolar ADC. Output is communicated to the PC’s terminal program via an RS-232 connection for the data visualization. </p> 
</article>


<h3>Principle</h3>
<p>A magnetic stripe is composed of a string of magnetic domains, each oriented in a way such that opposite poles are adjacent. In the areas where two magnets with like poles are touching, there is a concentration of magnetic flux which induces a current spike as they pass a magnetic read head. Each bit of information has the same physical length on the strip. The presence or absence of an additional peak in the middle of the bit determines whether it is a one or a zero. On a magnetic stripe, a one is comprised of a single magnet that is two units long and a zero is comprised of two magnets that are each one unit long. This encoding scheme is known as F2F encoding (or Aiken BiPhase).</p> 
  
<figure>
  <center><img src="/assets/image007.jpg" /><center>
  <figcaption><center><span class="post-meta small">The signals</span><center></figcaption>
</figure>

<h3>Data Format</h3>
<h4>Track 1 – IATA</h4>
<p>The data standard for Track 1 was developed by the International Air Transportation Association (IATA) and contains alphanumeric information. 
For example, on a credit card, this track typically contains the card holder’s name as embossed on the front of the card. The specification allows up to 79 characters. Each character is 7 bits long, comprising a 6 bit character code and a parity bit.</p>

<figure>
  <center><img src="/assets/magfrmt.png" /><center>
  <figcaption><center><span class="post-meta small">The format</span><center></figcaption>
</figure>

<p>
Control Characters:<br />
SS = Start Sentinel     %
FS = Field Separator   ^ 		FC    = Format Code <br />
ES = End Sentinel       ? 		LRC = Longitudinal Redundancy <br />

The Track 1 data format includes the following items:<br />

1. Approximately 62 leading clocking zeros.<br />
2. The Start Sentinel "%" (SS).<br />
3. Up to 76 alphanumeric characters.<br />
4. The end sentinel "?"(ES).<br />
5. The LRC (longitudinal redundancy check character).<br />
6. Trailing clocking zeros (minimum of 62) to the end of the card.<br />
 Each data character is in a 7-bit (6 plus parity) alphanumeric format. The data is in the format
"parity, 32, 16, 8, 4, 2, 1". Parity is odd (an odd number of "one's" in each character).
The character is written "backwards" on the card starting with the least significant digit and
ending with the parity bit. The card data format is "1, 2, 4, 8, 16, 32, parity".<br />

Example: Track1Information read on a Credit card.<br />
%B0123456789101112^ABCDEF/PQRST^01020304050607080910?8<br />

</p>

<h4>Track 2 – ABA</h4>
<p>The data standard for Track 2 was developed by the American Bankers Association (ABA), and contains
numeric information only. On a credit card, this track typically contains the card holder's credit card number as embossed on the front of the card. The specification allows up to 40 digits. Each digit is 5 bits long, comprising a 4-bit BCD digit and a parity bit. .</p>

<figure>
  <center><img src="/assets/magfrmt2.png" /><center>
  <figcaption><center><span class="post-meta small">The format</span><center></figcaption>
</figure>

<p>
The Track 2 data format include the following items:<br />

1. Leading clocking zeros: Approximately 22.<br />
2. The Start Sentinel ";" (SS).<br />
3. Up to 37 hexadecimal numeric characters.<br />
4. The end sentinel "?"(ES).<br />
5. The LRC (longitudinal redundancy check character).<br />
6. Trailing clocking zeros: A minimum of 22 (track 2) to the end of the card.<br />
Each data character is in a 5-bit (4 plus parity) numeric format. The data is in the format "parity,
8, 4, 2, 1. Parity is odd (an odd number of one's in each character).<br />

Example: Track2 Information read on a Credit card.<br />
;0123456789101112=01020304050607080910?:<br />

</p>

<figure>
  <center><img src="/assets/image004.png" /><center>
  <figcaption><center><span class="post-meta small">System Interconnection</span><center></figcaption>
</figure>

<h4>Hardware Set Up </h4>

<figure>
  <center><img src="/assets/explorer16.png" /><center>
  <figcaption><center><span class="post-meta small">Prototype design using Explorer-16 board</span><center></figcaption>
</figure>

<p>
1. Magnetic Card Reader Head. <br />
2. Op-Amp 6142. <br />
3. PIC24F Device. <br />
4. 9 V Power Supply. <br />
5. RS -232 Connectivity (MCP2200). <br />
6. Debugger Connectivity.  <br />
7. <a href="http://www.microchip.com/Developmenttools/ProductDetails.aspx?PartNO=DM240001">Explorer-16 board</a>. <br />

</p>

<figure>
  <center><img src="/assets/scope_0.png" /><center>
  <figcaption><center><span class="post-meta small">The output of magnetic read head</span><center></figcaption>
</figure>

<h4>The Algorithm </h4>
The Track1 and Track2 signals are amplified and fed the output of the Op-Amp to PIC24F microcontroller through analog ANx and ANy channels.<br />
 
Step 1: Start<br />
Step 2: Configure the ADC with Auto-Sample enabled. <br />
Step 3: Configure the Timer for computing the duration between 2 peaks. <br />
<figure>
  <center><img src="/assets/scope_30.png" /><center>
  <figcaption><center><span class="post-meta small">The output of Op-Amp and peak detection</span><center></figcaption>
</figure>
Step 4: Configure UART for 9600 Baudrate.  <br />
Step 5: Decode the F2F signal.       <br />
Step 6: Encrypt the data using AES symmetric encryption algorithm. <br />
Step 7: Transmit the data to the PC’s HyperTerminal program via an RS-232 coomunication protocol.<br />
Step 8: Stop<br />

<h4>Output on the HyperTerminal </h4>

<figure>
  <center><img src="/assets/vlcsnap-2015-10-26-10h59m14s992.png" /><center>
  <figcaption><center><span class="post-meta small">The card information on the HyperTerminal</span><center></figcaption>
</figure>


  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'MallikarjunTirlapur';
    var disqus_identifier = '/MasterThesis';
    var disqus_title      = '';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




      </div>
    </div>
  </div>


</body>
</html>
